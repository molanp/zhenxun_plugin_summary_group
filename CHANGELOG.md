# 更新日志 (Changelog)

本文档记录了群聊总结插件 (summary_group) 的所有重要变更。

## [2.1.0]

### 新增功能
- 🎨 补充缺失的配置选项(theme)，支持自定义主题风格
- ✨ 更加智能的API密钥轮换策略
- 🔍 优化背景处理，增加用户发好的错误消息

### 优化改进
- 🚀 优化消息处理逻辑，提升性能
- 🛠️ 优化消息处理逻辑变量，增加并发取取用户信息的功能
- 📊 重构消息队列处理，统一异常类
- 🔧 修复长度限制检查
- 🔄 优化配置项获取
- 📝 简化 Store 类
- 🔍 添加从 Chat_History 读取聊天记录的配置选项
- 🐛 修复 logger 报错
- 🔄 将模型配置迁移到 AI 项

## [2.0.0]

### 新增功能
- 添加多 AI 模型支持，允许在不同模型之间切换
  - 新增 `总结模型列表` 命令，查看所有可用的 AI 模型
  - 新增 `总结切换模型 <Provider/Model>` 命令，切换全局默认使用的 AI 模型
  - 新增 `/总结配置 模型 列表` 子命令，查看所有可用的 AI 模型
  - 新增 `/总结配置 模型 切换 <Provider/Model>` 子命令，切换全局默认使用的 AI 模型
  - 新增 `/总结配置 模型 设置 <Provider/Model> [-g 群号]` 子命令，设置群聊特定的 AI 模型
  - 新增 `/总结配置 模型 移除 [-g 群号]` 子命令，移除群聊特定的 AI 模型设置
- 添加分群模型配置功能，允许不同群聊使用不同的 AI 模型
- 添加分群风格配置功能，允许设置群聊默认的总结风格
  - 新增 `/总结配置 风格 设置 <风格名称> [-g 群号]` 子命令，设置群聊默认的总结风格
  - 新增 `/总结配置 风格 移除 [-g 群号]` 子命令，移除群聊默认的总结风格设置

### 优化改进
- 重构模型配置结构，使用 `AI.PROVIDERS` 按提供商分组管理模型
- 优化模型参数继承机制，支持在模型级别覆盖提供商级别的参数
- 提升模型相关设置的权限至 Superuser 级别
- 优化总结帮助文档，添加更详细的命令说明和示例
- 优化错误处理和日志记录，提供更清晰的错误信息
- 优化配置系统，统一使用 `Config.get('summary_group')` 获取配置项

### 修复问题
- 修复 `messages_summary()` 函数参数不匹配的问题
- 修复 Alconna 子命令结果处理的问题
- 修复 `SUMMARY_MAX_LENGTH` 验证逻辑的问题
- 修复风格设置需要 Bot 重启才能生效的问题
- 修复图片生成相关的问题

### 配置迁移说明

#### 模型提供商配置迁移
- 原配置：`summary_group.SUMMARY_PROVIDERS`
- 新配置：`AI.PROVIDERS`
- 迁移方法：将配置文件中的 `summary_group.SUMMARY_PROVIDERS` 移动到 `AI.PROVIDERS` 下

#### 当前激活模型配置
- 配置位置：`summary_group.CURRENT_ACTIVE_MODEL_NAME`（保持不变）
- 注意：当前激活的模型名称仍然保存在 `summary_group` 模块下，而不是 `AI` 模块下

#### 配置文件示例
```yaml
summary_group:
  CURRENT_ACTIVE_MODEL_NAME: DeepSeek/deepseek-chat
  # 其他 summary_group 配置...

AI:
  PROVIDERS:
    # 模型提供商配置...
```

#### 注意事项
- 如果您遇到模型实例化错误或模型回退到默认值的情况，请检查 `summary_group.CURRENT_ACTIVE_MODEL_NAME` 是否正确设置
- 所有模型相关的命令（如 `总结切换模型`）都会自动将配置保存到正确的位置

## [1.0.0]

### 初始功能
- 基本的群聊总结功能
  - 支持指定消息数量进行总结
  - 支持指定总结风格
  - 支持指定用户进行总结
  - 支持指定关键词进行总结
- 定时总结功能
  - 支持设置定时总结任务
  - 支持取消定时总结任务
  - 支持查看定时总结任务状态
- 系统管理功能
  - 支持健康检查
  - 支持系统修复
- 支持图片和文本两种输出方式
- 支持冷却时间限制
- 支持权限控制
